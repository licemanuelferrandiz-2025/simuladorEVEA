<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dise√±ador de EVEA - Traves√≠a Pedag√≥gica</title>
    <style>
        :root {
            --primary: #00d4ff;
            --success: #00ff88;
            --error: #ff3366;
            --bg-dark: #050505;
            --glass-bg: rgba(15, 20, 30, 0.95);
            --glass-border: rgba(255, 255, 255, 0.25);
        }

        body { 
            margin: 0; 
            overflow: hidden; 
            background-color: var(--bg-dark); 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            color: white;
            user-select: none;
        }

        canvas { display: block; position: fixed; top: 0; left: 0; z-index: 1; }

        /* BARRA INFERIOR - 120px para visibilidad del bot√≥n */
        #footer-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 100;
            background: rgba(0, 0, 0, 0.98);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--glass-border);
            display: flex;
            flex-direction: column;
        }

        #marquee-container {
            width: 100%;
            overflow: hidden;
            background: rgba(0, 212, 255, 0.15);
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        #marquee-text {
            display: inline-block;
            white-space: nowrap;
            font-size: 0.95rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 3px;
            color: var(--primary);
            animation: marquee-rtl 30s linear infinite;
        }

        @keyframes marquee-rtl {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        #audio-row {
            width: 100%;
            height: 120px; 
            background: #103059;
            overflow: hidden;
        }

        /* ZONAS LATERALES */
        .drop-zone {
            position: absolute;
            top: 0;
            width: 25vw;
            height: calc(100vh - 180px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5;
            font-size: 2.2rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 6px;
            transition: all 0.3s ease;
            pointer-events: none;
            opacity: 0.6;
        }

        #zone-false { 
            left: 0; 
            background: linear-gradient(to right, rgba(255, 51, 102, 0.4), transparent); 
            color: var(--error);
            border-right: 3px solid var(--error);
            text-shadow: 0 0 15px var(--error);
        }

        #zone-true { 
            right: 0; 
            background: linear-gradient(to left, rgba(0, 255, 136, 0.4), transparent); 
            color: var(--success);
            border-left: 3px solid var(--success);
            text-shadow: 0 0 15px var(--success);
        }

        /* TARJETA TAMA√ëO ORIGINAL */
        #question-card {
            position: absolute;
            top: 30%; 
            left: 50%;
            width: 380px; 
            background: var(--glass-bg);
            backdrop-filter: blur(30px);
            padding: 30px; 
            border-radius: 30px;
            border: 2px solid var(--glass-border);
            box-shadow: 0 30px 80px rgba(0,0,0,0.8);
            z-index: 20;
            text-align: center;
            transform: translate(-50%, -50%);
            cursor: grab;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        #question-card h1 { font-size: 0.85rem; color: var(--primary); margin-bottom: 12px; letter-spacing: 3px; text-transform: uppercase; }
        #question-card h2 { font-size: 1.25rem; margin: 0; line-height: 1.4; font-weight: 600; color: #fff; }

        .dragging { border-color: var(--primary) !important; box-shadow: 0 0 50px rgba(0, 212, 255, 0.4) !important; }

        /* OVERLAYS ORIGINALES */
        #intro-overlay {
            position: fixed;
            inset: 0;
            background: var(--bg-dark);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .intro-box {
            max-width: 600px;
            padding: 50px;
            background: var(--glass-bg);
            border-radius: 40px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 0 60px rgba(0,0,0,0.7);
        }

        .btn-main {
            padding: 18px 60px;
            background: var(--primary);
            color: black;
            border: none;
            border-radius: 50px;
            font-weight: 900;
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 30px;
            text-transform: uppercase;
        }

        .btn-main:hover { transform: scale(1.05); background: #fff; box-shadow: 0 0 30px var(--primary); }

        .feedback-pop {
            position: fixed;
            top: 15%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 50;
            font-size: 1.6rem;
            font-weight: 800;
            text-align: center;
            display: none;
            padding: 20px 50px;
            border-radius: 100px;
            background: rgba(0,0,0,0.95);
            border: 3px solid white;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn { from { transform: translateX(-50%) scale(0.5); opacity: 0; } to { transform: translateX(-50%) scale(1); opacity: 1; } }

        #score-tag {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            font-size: 0.85rem;
            background: rgba(0,0,0,0.7);
            padding: 10px 25px;
            border-radius: 50px;
            border: 1px solid var(--glass-border);
            font-weight: bold;
            color: var(--primary);
        }

        .reflection-content {
            font-size: 0.95rem;
            line-height: 1.7;
            color: #ddd;
            margin: 20px 0;
            text-align: justify;
        }
    </style>
</head>
<body>

    <div id="score-tag">PUNTOS: 0</div>

    <div id="footer-bar">
        <div id="marquee-container">
            <div id="marquee-text">
                EL DOCENTE COMO DISE√ëADOR DE ENTORNOS VIRTUALES DE ENSE√ëANZA Y APRENDIZAJE (EVEA) ‚Ä¢ INTENCIONALIDAD PEDAG√ìGICA ANTES QUE HERRAMIENTA ‚Ä¢ V√çNCULO HUMANO ‚Ä¢ TRANSFORMACI√ìN EN ALTAMAR ‚Ä¢ APRENDIZAJE ACTIVO ‚Ä¢ EVALUACI√ìN FORMATIVA
            </div>
        </div>
        <div id="audio-row">
            <iframe id="sc-widget" width="100%" height="120" scrolling="no" frameborder="no" allow="autoplay" 
            src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/2231655206&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true"></iframe>
        </div>
    </div>
    
    <div id="intro-overlay">
        <div class="intro-box">
            <h1 style="color: var(--primary); letter-spacing: 4px; text-shadow: 0 0 25px rgba(0,212,255,0.4);">üåä TRAVES√çA VIRTUAL</h1>
            <p style="font-size: 1.3rem; line-height: 1.5; font-weight: 600; margin-bottom: 20px;">¬°Bienvenidos al juego <b>Traves√≠a Virtual</b>!</p>
            <p style="font-size: 1.1rem; line-height: 1.5; color: #cbd5e1; margin-bottom: 15px;">La idea es que seas el <b>dise√±ador de entornos virtuales de ense√±anza y aprendizaje (EVEA)</b>.</p>
            <p style="font-size: 1.05rem; color: var(--primary); font-weight: 700; margin-top: 15px;">‚ö†Ô∏è Activa la m√∫sica que te ayudar√° a interpretar las respuestas en esta traves√≠a pedag√≥gica.</p>
            <button class="btn-main" onclick="startJourney()">Comenzar Traves√≠a</button>
        </div>
    </div>

    <div id="zone-false" class="drop-zone">FALSO</div>
    <div id="zone-true" class="drop-zone">VERDADERO</div>

    <div id="question-card" style="display:none" onmousedown="handleDragStart(event)">
        <h1 id="step-category">CATEGOR√çA</h1>
        <h2 id="step-question">Cargando desaf√≠o...</h2>
        <p style="font-size: 0.6rem; opacity: 0.5; margin-top: 25px; letter-spacing: 2px; font-weight: bold; color: var(--primary);">CLIC Y ARRASTRA A UN LATERAL</p>
    </div>

    <div id="feedback-panel" class="feedback-pop"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        function startMusic() {
            const widget = document.getElementById('sc-widget');
            const currentSrc = widget.src;
            widget.src = currentSrc.replace("auto_play=false", "auto_play=true");
        }

        let points = 0;
        let activeStep = 0;
        let isDraggingCard = false;
        let isLock = false;
        
        let baseCardY = window.innerHeight * 0.3;
        let cardCoords = { x: window.innerWidth / 2, y: baseCardY };
        let dragOffset = { x: 0, y: 0 };
        
        const challenges = [
            { cat: 'üìå PLANIFICACI√ìN EVEA', q: '¬øVirtualizar una propuesta consiste en trasladar contenidos presenciales al aula digital sin redefinir la planificaci√≥n?', ans: false, shape: 'saturn', win: '‚úÖ ¬°Exacto! Requiere un redise√±o profundo.', fail: '‚ùå ¬°Incorrecto!' },
            { cat: 'üèóÔ∏è ROL DEL DISE√ëADOR', q: '¬øEl docente debe actuar como un "arquitecto del escenario virtual", creando las condiciones did√°cticas?', ans: true, shape: 'flower', win: '‚úÖ ¬°Excelente! Dise√±as experiencias.', fail: '‚ùå ¬°Error!' },
            { cat: 'üé® PUNTO DE PARTIDA', q: '¬øEn la planificaci√≥n de un EVEA, el punto de partida debe ser la herramienta tecnol√≥gica antes que la pedagog√≠a?', ans: false, shape: 'heart', win: '‚úÖ ¬°Muy bien! La pedagog√≠a es lo primero.', fail: '‚ùå ¬°Incorrecto!' },
            { cat: '‚öôÔ∏è DIN√ÅMICA', q: '¬øLas instancias asincr√≥nicas ofrecen tiempos flexibles para la reflexi√≥n y construcci√≥n?', ans: true, shape: 'saturn', win: '‚úÖ ¬°Exacto! Clave para la profundidad.', fail: '‚ùå ¬°Falso!' },
            { cat: 'üó£Ô∏è INTERACCI√ìN', q: '¬øEn la educaci√≥n en l√≠nea, el aprendizaje se propicia principalmente por la mera exposici√≥n?', ans: false, shape: 'flower', win: '‚úÖ ¬°Excelente! Las actividades generan aprendizaje.', fail: '‚ùå ¬°Error!' },
            { cat: 'üõ†Ô∏è PRODUCCI√ìN', q: '¬øEs fundamental fomentar la producci√≥n de contenidos originales (videos, podcasts) para evidenciar comprensi√≥n?', ans: true, shape: 'heart', win: '‚úÖ ¬°Correcto! La creaci√≥n supera a la reproducci√≥n.', fail: '‚ùå ¬°Falso!' },
            { cat: 'üìä EVALUACI√ìN', q: '¬øLas herramientas digitales permiten transformar la evaluaci√≥n en un proceso formativo basado en "huellas"?', ans: true, shape: 'saturn', win: '‚úÖ ¬°Exacto! Permite analizar procesos.', fail: '‚ùå ¬°Falso!' },
            { cat: 'üì¢ RETROALIMENTACI√ìN', q: '¬øLa retroalimentaci√≥n en entornos virtuales solo debe centrarse en se√±alar errores?', ans: false, shape: 'flower', win: '‚úÖ ¬°Bien! Debe ser un di√°logo pedag√≥gico.', fail: '‚ùå ¬°Incorrecto!' },
            { cat: '‚öñÔ∏è √âTICA Y ACCESO', q: '¬øEl Dise√±o Universal para el Aprendizaje (DUA) busca garantizar la inclusi√≥n mediante curr√≠culos flexibles?', ans: true, shape: 'heart', win: '‚úÖ ¬°Correcto! Es indispensable.', fail: '‚ùå ¬°Incorrecto!' }
        ];

        const cardElement = document.getElementById('question-card');
        const feedbackPanel = document.getElementById('feedback-panel');

        function startJourney() {
            document.getElementById('intro-overlay').style.display = 'none';
            cardElement.style.display = 'block';
            startMusic(); 
            loadStep();
        }

        function loadStep() {
            if (activeStep >= challenges.length) { showReflection(); return; }
            isLock = false; isDraggingCard = false;
            const data = challenges[activeStep];
            document.getElementById('step-category').innerText = data.cat;
            document.getElementById('step-question').innerText = data.q;
            
            cardCoords.x = window.innerWidth / 2;
            cardCoords.y = baseCardY;
            refreshCardUI();
            cardElement.classList.remove('dragging');
            
            currentShapeMode = data.shape;
            initTargetPositions();
            particleMaterial.color.set(0x00d4ff);
        }

        function refreshCardUI() {
            if(isNaN(cardCoords.x) || isNaN(cardCoords.y)) return;
            cardElement.style.left = `${cardCoords.x}px`;
            cardElement.style.top = `${cardCoords.y}px`;
        }

        function handleDragStart(e) {
            if (isLock) return;
            isDraggingCard = true;
            cardElement.classList.add('dragging');
            dragOffset.x = e.clientX - cardCoords.x;
            dragOffset.y = e.clientY - cardCoords.y;
        }

        window.addEventListener('mousemove', (e) => {
            if (!isDraggingCard || isLock) return;
            cardCoords.x = e.clientX - dragOffset.x;
            cardCoords.y = e.clientY - dragOffset.y;
            refreshCardUI();

            const w = window.innerWidth;
            const threshold = w * 0.25;
            document.getElementById('zone-false').style.opacity = cardCoords.x < threshold ? '1' : '0.4';
            document.getElementById('zone-true').style.opacity = cardCoords.x > w - threshold ? '1' : '0.4';
        });

        window.addEventListener('mouseup', () => {
            if (!isDraggingCard || isLock) return;
            isDraggingCard = false;
            cardElement.classList.remove('dragging');

            const w = window.innerWidth;
            const threshold = w * 0.25;

            if (cardCoords.x < threshold) resolveChoice(false);
            else if (cardCoords.x > w - threshold) resolveChoice(true);
            else {
                cardCoords.x = w / 2;
                cardCoords.y = baseCardY;
                refreshCardUI();
            }
        });

        function resolveChoice(pick) {
            isLock = true;
            const isCorrect = pick === challenges[activeStep].ans;
            if (isCorrect) points += 10;
            document.getElementById('score-tag').innerText = `PUNTOS: ${points}`;

            feedbackPanel.innerText = isCorrect ? challenges[activeStep].win : challenges[activeStep].fail;
            feedbackPanel.style.display = 'block';
            feedbackPanel.style.color = isCorrect ? 'var(--success)' : 'var(--error)';
            feedbackPanel.style.borderColor = isCorrect ? 'var(--success)' : 'var(--error)';
            
            particleMaterial.color.set(isCorrect ? 0x00ff88 : 0xff3366);

            setTimeout(() => {
                feedbackPanel.style.display = 'none';
                activeStep++;
                loadStep();
            }, 3000);
        }

        function showReflection() {
            isLock = true;
            cardElement.onmousedown = null;
            cardElement.style.cursor = 'default';
            cardElement.style.zIndex = "250"; 

            cardElement.innerHTML = `
                <h1 style="color:var(--success)">‚öì MUCHAS GRACIAS</h1>
                <p style="font-weight:bold; margin-top:5px; font-size:0.9rem;">¬°ROL DE DISE√ëADOR EVEA VALIDADO!</p>
                <div class="reflection-content">
                    <b>Reflexi√≥n Final:</b> Como dise√±ador de <b>EVEA</b>, has comprendido que la tecnolog√≠a es un medio pedag√≥gico para propuestas coherentes. Redefinir la pr√°ctica docente implica entender que el entorno digital es un aula expandida donde la planificaci√≥n debe ser flexible y situada. 
                    Un verdadero arquitecto sostiene el v√≠nculo humano y promueve un aprendizaje que potencie los procesos.
                </div>
                <button class="btn-main" onclick="location.reload()" style="position: relative; z-index: 260; padding: 15px 40px;">Comenzar de vuelta</button>
            `;
            
            cardCoords.x = window.innerWidth / 2;
            cardCoords.y = window.innerHeight * 0.32; 
            refreshCardUI();
            currentShapeMode = 'fireworks';
            initTargetPositions();
        }

        // --- MOTOR 3D ---
        const PART_TOTAL = 3000;
        let currentShapeMode = 'saturn';
        const scene3d = new THREE.Scene();
        const camera3d = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera3d.position.z = 50;
        const renderer3d = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer3d.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer3d.domElement);

        const particleGeo = new THREE.BufferGeometry();
        const posBuffer = new Float32Array(PART_TOTAL * 3);
        const targetBuffer = new Float32Array(PART_TOTAL * 3);
        
        // Inicializaci√≥n segura para evitar NaNs
        for(let i=0; i<PART_TOTAL*3; i++) { 
            posBuffer[i] = (Math.random()-0.5)*150 || 0; 
            targetBuffer[i] = 0;
        }
        particleGeo.setAttribute('position', new THREE.BufferAttribute(posBuffer, 3));

        const particleMaterial = new THREE.PointsMaterial({ size: 0.5, blending: THREE.AdditiveBlending, transparent: true, color: 0x00d4ff, depthWrite: false });
        const particlePoints = new THREE.Points(particleGeo, particleMaterial);
        scene3d.add(particlePoints);

        function initTargetPositions() {
            for (let i = 0; i < PART_TOTAL; i++) {
                const i3 = i * 3;
                let x = 0, y = 0, z = 0;
                if (currentShapeMode === 'heart') {
                    const t = Math.PI * (Math.random() - 0.5) * 2;
                    x = 16 * Math.pow(Math.sin(t), 3) * 0.8; y = (13*Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t)) * 0.8; z = (Math.random()-0.5)*5;
                } else if (currentShapeMode === 'saturn') {
                    const angle = Math.random() * Math.PI * 2;
                    if (i < PART_TOTAL * 0.6) {
                        const phi = Math.acos(Math.max(-1, Math.min(1, -1 + (2 * i) / (PART_TOTAL * 0.6))));
                        const theta = Math.sqrt(PART_TOTAL * Math.PI) * phi;
                        x = 10 * Math.cos(theta) * Math.sin(phi); y = 10 * Math.sin(theta) * Math.sin(phi); z = 10 * Math.cos(phi);
                    } else {
                        const r = 16 + Math.random() * 6; x = r * Math.cos(angle); y = (Math.random()-0.5)*2; z = r * Math.sin(angle);
                    }
                } else if (currentShapeMode === 'flower') {
                    const angle = i * 0.15; const r = 0.25 * Math.sqrt(i) * 1.5;
                    x = r * Math.cos(angle); y = r * Math.sin(angle); z = Math.sin(r * 0.4) * 8;
                } else {
                    const r = Math.pow(Math.random(), 1/3) * 35; const theta = Math.random() * Math.PI * 2; const phi = Math.random() * Math.PI;
                    x = r * Math.sin(phi) * Math.cos(theta); y = r * Math.sin(phi) * Math.sin(theta); z = r * Math.cos(phi);
                }
                targetBuffer[i3] = x || 0; 
                targetBuffer[i3+1] = y || 0; 
                targetBuffer[i3+2] = z || 0;
            }
        }

        function animateFrame() {
            requestAnimationFrame(animateFrame);
            const livePos = particleGeo.attributes.position.array;
            
            const winW = window.innerWidth || 1;
            const winH = window.innerHeight || 1;
            const cX = isNaN(cardCoords.x) ? winW/2 : cardCoords.x;
            const cY = isNaN(cardCoords.y) ? winH/2 : cardCoords.y;

            const driftX = (0.5 - cX / winW) * 45;
            const driftY = (0.5 - cY / winH) * 35;

            for (let i = 0; i < PART_TOTAL; i++) {
                const i3 = i * 3;
                livePos[i3] += (targetBuffer[i3] + driftX - livePos[i3]) * 0.05;
                livePos[i3+1] += (targetBuffer[i3+1] + driftY - livePos[i3+1]) * 0.05;
                livePos[i3+2] += (targetBuffer[i3+2] - livePos[i3+2]) * 0.05;
                
                // Limpieza de seguridad por si alg√∫n NaN se filtr√≥
                if(isNaN(livePos[i3])) livePos[i3] = 0;
                if(isNaN(livePos[i3+1])) livePos[i3+1] = 0;
                if(isNaN(livePos[i3+2])) livePos[i3+2] = 0;
            }
            particleGeo.attributes.position.needsUpdate = true;
            particlePoints.rotation.y += 0.002;
            renderer3d.render(scene3d, camera3d);
        }

        initTargetPositions();
        animateFrame();

        window.addEventListener('resize', () => {
            camera3d.aspect = window.innerWidth / window.innerHeight;
            camera3d.updateProjectionMatrix();
            renderer3d.setSize(window.innerWidth, window.innerHeight);
            baseCardY = window.innerHeight * 0.3;
            if(!isDraggingCard) { 
                cardCoords.x = window.innerWidth / 2; 
                cardCoords.y = baseCardY; 
                refreshCardUI(); 
            }
        });
    </script>
</body>
</html>
