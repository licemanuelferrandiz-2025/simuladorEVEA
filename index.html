<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dise√±ador de EVEA - Traves√≠a Pedag√≥gica</title>
    <style>
        :root {
            --primary: #00d4ff;
            --success: #00ff88;
            --error: #ff3366;
            --bg-dark: #050505;
            --glass-bg: rgba(15, 20, 30, 0.95);
            --glass-border: rgba(255, 255, 255, 0.25);
        }

        body { 
            margin: 0; 
            overflow: hidden; 
            background-color: var(--bg-dark); 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            color: white;
            user-select: none;
        }

        canvas { display: block; position: fixed; top: 0; left: 0; z-index: 1; }

        /* BARRA INFERIOR MUY COMPACTA */
        #footer-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 100;
            background: rgba(0, 0, 0, 0.98);
            backdrop-filter: blur(15px);
            border-top: 1px solid var(--glass-border);
            display: flex;
            flex-direction: column;
        }

        #marquee-container {
            width: 100%;
            overflow: hidden;
            background: rgba(0, 212, 255, 0.1);
            padding: 4px 0;
        }

        #marquee-text {
            display: inline-block;
            white-space: nowrap;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--primary);
            animation: marquee-rtl 25s linear infinite;
        }

        @keyframes marquee-rtl {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        #audio-row {
            width: 100%;
            height: 100px; /* Reducido para dejar m√°s espacio al juego */
            background: #0a1a2f;
            overflow: hidden;
        }

        /* ZONAS LATERALES */
        .drop-zone {
            position: absolute;
            top: 0;
            width: 20vw;
            height: calc(100vh - 140px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5;
            font-size: 1.3rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 3px;
            transition: all 0.3s ease;
            pointer-events: none;
            opacity: 0.3;
        }

        #zone-false { left: 0; background: linear-gradient(to right, rgba(255, 51, 102, 0.15), transparent); color: var(--error); border-right: 2px solid var(--error); }
        #zone-true { right: 0; background: linear-gradient(to left, rgba(0, 255, 136, 0.15), transparent); color: var(--success); border-left: 2px solid var(--success); }

        /* TARJETA PEQUE√ëA */
        #question-card {
            position: absolute;
            top: 28%; /* M√°s arriba para evitar solapamientos */
            left: 50%;
            width: 300px; 
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            padding: 15px 20px; 
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 15px 40px rgba(0,0,0,0.8);
            z-index: 20;
            text-align: center;
            transform: translate(-50%, -50%);
            cursor: grab;
        }

        #question-card h1 { font-size: 0.65rem; color: var(--primary); margin-bottom: 5px; letter-spacing: 2px; text-transform: uppercase; }
        #question-card h2 { font-size: 1rem; margin: 0; line-height: 1.3; font-weight: 600; color: #fff; }

        .dragging { border-color: var(--primary) !important; box-shadow: 0 0 25px rgba(0, 212, 255, 0.3) !important; }

        /* OVERLAY DE INICIO */
        #intro-overlay {
            position: fixed;
            inset: 0;
            background: var(--bg-dark);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }

        .intro-box {
            max-width: 400px;
            padding: 25px;
            background: var(--glass-bg);
            border-radius: 20px;
            border: 1px solid var(--glass-border);
        }

        .btn-main {
            padding: 10px 30px;
            background: var(--primary);
            color: black;
            border: none;
            border-radius: 25px;
            font-weight: 900;
            font-size: 0.9rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 15px;
            text-transform: uppercase;
        }

        .btn-main:hover { transform: scale(1.05); background: #fff; }

        .feedback-pop {
            position: fixed;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 200;
            font-size: 1.1rem;
            font-weight: 800;
            text-align: center;
            display: none;
            padding: 10px 25px;
            border-radius: 50px;
            background: rgba(0,0,0,0.95);
            border: 2px solid white;
            animation: popIn 0.3s ease-out;
        }

        @keyframes popIn { from { transform: translateX(-50%) scale(0.8); opacity: 0; } to { transform: translateX(-50%) scale(1); opacity: 1; } }

        #score-tag {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 100;
            font-size: 0.7rem;
            background: rgba(0,0,0,0.7);
            padding: 5px 12px;
            border-radius: 15px;
            border: 1px solid var(--glass-border);
            color: var(--primary);
        }

        .reflection-content {
            font-size: 0.75rem;
            line-height: 1.4;
            color: #ccc;
            margin: 8px 0;
            text-align: justify;
        }
    </style>
</head>
<body>

    <div id="score-tag">PUNTOS: 0</div>

    <div id="footer-bar">
        <div id="marquee-container">
            <div id="marquee-text">
                EL DOCENTE COMO DISE√ëADOR DE ENTORNOS VIRTUALES DE ENSE√ëANZA Y APRENDIZAJE (EVEA) ‚Ä¢ INTENCIONALIDAD PEDAG√ìGICA ANTES QUE HERRAMIENTA ‚Ä¢ V√çNCULO HUMANO ‚Ä¢ TRANSFORMACI√ìN EN ALTAMAR ‚Ä¢ APRENDIZAJE ACTIVO
            </div>
        </div>
        <div id="audio-row">
            <iframe id="sc-widget" width="100%" height="100" scrolling="no" frameborder="no" allow="autoplay" 
            src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/2231655206&color=%2300d4ff&auto_play=false&hide_related=true&show_comments=false&show_user=false&show_reposts=false&show_teaser=false&visual=false"></iframe>
        </div>
    </div>
    
    <div id="intro-overlay">
        <div class="intro-box">
            <h1 style="color: var(--primary); font-size: 1.3rem; margin-bottom: 10px;">üåä TRAVES√çA VIRTUAL</h1>
            <p style="font-size: 0.9rem; margin-bottom: 8px;">Dise√±a tu entorno virtual (EVEA).</p>
            <p style="font-size: 0.8rem; color: #cbd5e1;">Arrastra las tarjetas para validar tu visi√≥n pedag√≥gica.</p>
            <button class="btn-main" onclick="startJourney()">Comenzar</button>
        </div>
    </div>

    <div id="zone-false" class="drop-zone">FALSO</div>
    <div id="zone-true" class="drop-zone">VERDADERO</div>

    <div id="question-card" style="display:none" onmousedown="handleDragStart(event)">
        <h1 id="step-category">CATEGOR√çA</h1>
        <h2 id="step-question">Cargando desaf√≠o...</h2>
        <p style="font-size: 0.5rem; opacity: 0.5; margin-top: 10px; letter-spacing: 1px; font-weight: bold; color: var(--primary);">ARRASTRA A LOS LADOS</p>
    </div>

    <div id="feedback-panel" class="feedback-pop"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        function startMusic() {
            const widget = document.getElementById('sc-widget');
            widget.src = widget.src.replace("auto_play=false", "auto_play=true");
        }

        let points = 0;
        let activeStep = 0;
        let isDraggingCard = false;
        let isLock = false;
        
        let baseCardY = window.innerHeight * 0.28;
        let cardCoords = { x: window.innerWidth / 2, y: baseCardY };
        let dragOffset = { x: 0, y: 0 };
        
        const challenges = [
            { cat: 'üìå PLANIFICACI√ìN', q: '¬øVirtualizar consiste en trasladar contenidos presenciales sin redefinir la planificaci√≥n?', ans: false, shape: 'saturn', win: '‚úÖ ¬°Exacto! Requiere redise√±o.', fail: '‚ùå ¬°Incorrecto!' },
            { cat: 'üèóÔ∏è ROL', q: '¬øEl docente debe ser un "arquitecto del escenario virtual" creando condiciones did√°cticas?', ans: true, shape: 'flower', win: '‚úÖ ¬°Excelente! Dise√±as experiencias.', fail: '‚ùå ¬°Error!' },
            { cat: 'üé® PARTIDA', q: '¬øEl punto de partida debe ser la tecnolog√≠a antes que la pedagog√≠a?', ans: false, shape: 'heart', win: '‚úÖ ¬°Bien! Pedagog√≠a primero.', fail: '‚ùå ¬°No! Tecnolog√≠a es medio.' },
            { cat: '‚öôÔ∏è DIN√ÅMICA', q: '¬øLas instancias asincr√≥nicas ofrecen tiempos flexibles para la reflexi√≥n?', ans: true, shape: 'saturn', win: '‚úÖ ¬°Exacto! Vital para profundidad.', fail: '‚ùå ¬°Falso!' },
            { cat: 'üó£Ô∏è INTERACCI√ìN', q: '¬øEl aprendizaje se propicia principalmente por la mera exposici√≥n?', ans: false, shape: 'flower', win: '‚úÖ ¬°Bien! Actividades mandan.', fail: '‚ùå ¬°Error!' },
            { cat: 'üõ†Ô∏è PRODUCCI√ìN', q: '¬øEs fundamental fomentar la producci√≥n de contenidos originales?', ans: true, shape: 'heart', win: '‚úÖ ¬°Correcto! Evidencia comprensi√≥n.', fail: '‚ùå ¬°Falso!' },
            { cat: 'üìä EVALUACI√ìN', q: '¬øLas herramientas digitales permiten transformar la evaluaci√≥n en formativa?', ans: true, shape: 'saturn', win: '‚úÖ ¬°Exacto! Analiza procesos.', fail: '‚ùå ¬°Falso!' },
            { cat: 'üì¢ FEEDBACK', q: '¬øLa retroalimentaci√≥n virtual solo debe se√±alar errores?', ans: false, shape: 'flower', win: '‚úÖ ¬°Bien! Debe ser di√°logo.', fail: '‚ùå ¬°Incorrecto!' },
            { cat: '‚öñÔ∏è INCLUSI√ìN', q: '¬øEl DUA busca garantizar inclusi√≥n mediante curr√≠culos flexibles?', ans: true, shape: 'heart', win: '‚úÖ ¬°Correcto! √âtica indispensable.', fail: '‚ùå ¬°Error!' }
        ];

        const cardElement = document.getElementById('question-card');
        const feedbackPanel = document.getElementById('feedback-panel');

        function startJourney() {
            document.getElementById('intro-overlay').style.display = 'none';
            cardElement.style.display = 'block';
            startMusic(); 
            loadStep();
        }

        function loadStep() {
            if (activeStep >= challenges.length) { showReflection(); return; }
            isLock = false; isDraggingCard = false;
            const data = challenges[activeStep];
            document.getElementById('step-category').innerText = data.cat;
            document.getElementById('step-question').innerText = data.q;
            
            cardCoords.x = window.innerWidth / 2;
            cardCoords.y = baseCardY;
            refreshCardUI();
            cardElement.classList.remove('dragging');
            
            currentShapeMode = data.shape;
            initTargetPositions();
            particleMaterial.color.set(0x00d4ff);
        }

        function refreshCardUI() {
            cardElement.style.left = `${cardCoords.x}px`;
            cardElement.style.top = `${cardCoords.y}px`;
        }

        function handleDragStart(e) {
            if (isLock) return;
            isDraggingCard = true;
            cardElement.classList.add('dragging');
            dragOffset.x = e.clientX - cardCoords.x;
            dragOffset.y = e.clientY - cardCoords.y;
        }

        window.addEventListener('mousemove', (e) => {
            if (!isDraggingCard || isLock) return;
            cardCoords.x = e.clientX - dragOffset.x;
            cardCoords.y = e.clientY - dragOffset.y;
            refreshCardUI();

            const threshold = window.innerWidth * 0.2;
            document.getElementById('zone-false').style.opacity = cardCoords.x < threshold ? '1' : '0.3';
            document.getElementById('zone-true').style.opacity = cardCoords.x > window.innerWidth - threshold ? '1' : '0.3';
        });

        window.addEventListener('mouseup', () => {
            if (!isDraggingCard || isLock) return;
            isDraggingCard = false;
            cardElement.classList.remove('dragging');

            const threshold = window.innerWidth * 0.2;
            if (cardCoords.x < threshold) resolveChoice(false);
            else if (cardCoords.x > window.innerWidth - threshold) resolveChoice(true);
            else {
                cardCoords.x = window.innerWidth / 2;
                cardCoords.y = baseCardY;
                refreshCardUI();
            }
        });

        function resolveChoice(pick) {
            isLock = true;
            const isCorrect = pick === challenges[activeStep].ans;
            if (isCorrect) points += 10;
            document.getElementById('score-tag').innerText = `PUNTOS: ${points}`;

            feedbackPanel.innerText = isCorrect ? challenges[activeStep].win : challenges[activeStep].fail;
            feedbackPanel.style.display = 'block';
            feedbackPanel.style.color = isCorrect ? 'var(--success)' : 'var(--error)';
            feedbackPanel.style.borderColor = isCorrect ? 'var(--success)' : 'var(--error)';
            
            particleMaterial.color.set(isCorrect ? 0x00ff88 : 0xff3366);

            setTimeout(() => {
                feedbackPanel.style.display = 'none';
                activeStep++;
                loadStep();
            }, 2000);
        }

        function showReflection() {
            isLock = true;
            cardElement.onmousedown = null;
            cardElement.style.cursor = 'default';

            cardElement.innerHTML = `
                <h1 style="color:var(--success); font-size: 0.9rem;">‚öì TRAVES√çA FINALIZADA</h1>
                <div class="reflection-content">
                    <b>Resumen:</b> Has validado tu rol como arquitecto virtual. Entender que la pedagog√≠a gu√≠a a la tecnolog√≠a es el tim√≥n de tu pr√°ctica. Dise√±ar experiencias reales transforma el aprendizaje en el mar digital.
                </div>
                <button class="btn-main" onclick="location.reload()" style="margin-top: 5px; padding: 8px 20px;">Comenzar de vuelta</button>
            `;
            
            cardCoords.x = window.innerWidth / 2;
            cardCoords.y = window.innerHeight * 0.3;
            refreshCardUI();
            currentShapeMode = 'fireworks';
            initTargetPositions();
        }

        // --- MOTOR 3D ---
        const PART_TOTAL = 2000;
        let currentShapeMode = 'saturn';
        const scene3d = new THREE.Scene();
        const camera3d = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera3d.position.z = 50;
        const renderer3d = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer3d.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer3d.domElement);

        const particleGeo = new THREE.BufferGeometry();
        const posBuffer = new Float32Array(PART_TOTAL * 3);
        const targetBuffer = new Float32Array(PART_TOTAL * 3);
        for(let i=0; i<PART_TOTAL*3; i++) { posBuffer[i] = (Math.random()-0.5)*150; }
        particleGeo.setAttribute('position', new THREE.BufferAttribute(posBuffer, 3));

        const particleMaterial = new THREE.PointsMaterial({ size: 0.4, blending: THREE.AdditiveBlending, transparent: true, color: 0x00d4ff, depthWrite: false });
        const particlePoints = new THREE.Points(particleGeo, particleMaterial);
        scene3d.add(particlePoints);

        function initTargetPositions() {
            for (let i = 0; i < PART_TOTAL; i++) {
                const i3 = i * 3;
                let x = 0, y = 0, z = 0;
                if (currentShapeMode === 'heart') {
                    const t = Math.PI * (Math.random() - 0.5) * 2;
                    x = 16 * Math.pow(Math.sin(t), 3) * 0.6; y = (13*Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t)) * 0.6; z = (Math.random()-0.5)*5;
                } else if (currentShapeMode === 'saturn') {
                    const angle = Math.random() * Math.PI * 2;
                    if (i < PART_TOTAL * 0.6) {
                        const phi = Math.acos(-1 + (2 * i) / (PART_TOTAL * 0.6));
                        const theta = Math.sqrt(PART_TOTAL * Math.PI) * phi;
                        x = 10 * Math.cos(theta) * Math.sin(phi); y = 10 * Math.sin(theta) * Math.sin(phi); z = 10 * Math.cos(phi);
                    } else {
                        const r = 16 + Math.random() * 6; x = r * Math.cos(angle); y = (Math.random()-0.5)*2; z = r * Math.sin(angle);
                    }
                } else if (currentShapeMode === 'flower') {
                    const angle = i * 0.15; const r = 0.2 * Math.sqrt(i) * 1.5;
                    x = r * Math.cos(angle); y = r * Math.sin(angle); z = Math.sin(r * 0.4) * 8;
                } else {
                    const r = Math.pow(Math.random(), 1/3) * 30; const theta = Math.random() * Math.PI * 2; const phi = Math.random() * Math.PI;
                    x = r * Math.sin(phi) * Math.cos(theta); y = r * Math.sin(phi) * Math.sin(theta); z = r * Math.cos(phi);
                }
                targetBuffer[i3] = x; targetBuffer[i3+1] = y; targetBuffer[i3+2] = z;
            }
        }

        function animateFrame() {
            requestAnimationFrame(animateFrame);
            const livePos = particleGeo.attributes.position.array;
            const driftX = (0.5 - cardCoords.x / window.innerWidth) * 35;
            const driftY = (0.5 - cardCoords.y / window.innerHeight) * 25;

            for (let i = 0; i < PART_TOTAL; i++) {
                const i3 = i * 3;
                livePos[i3] += (targetBuffer[i3] + driftX - livePos[i3]) * 0.07;
                livePos[i3+1] += (targetBuffer[i3+1] + driftY - livePos[i3+1]) * 0.07;
                livePos[i3+2] += (targetBuffer[i3+2] - livePos[i3+2]) * 0.07;
            }
            particleGeo.attributes.position.needsUpdate = true;
            particlePoints.rotation.y += 0.002;
            renderer3d.render(scene3d, camera3d);
        }

        initTargetPositions();
        animateFrame();

        window.addEventListener('resize', () => {
            camera3d.aspect = window.innerWidth / window.innerHeight;
            camera3d.updateProjectionMatrix();
            renderer3d.setSize(window.innerWidth, window.innerHeight);
            baseCardY = window.innerHeight * 0.28;
            if(!isDraggingCard) { cardCoords.x = window.innerWidth / 2; cardCoords.y = baseCardY; refreshCardUI(); }
        });
    </script>
</body>
</html>
